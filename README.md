# Vehicle Supplies WebSite

这是一个独立站的电商系统，主要提供以下功能

a. 产品的展示，询价，下单，
b. 用户信息，订单管理
c. 物流跟踪功能

系统使用vue 做前端，nodejs 做后端，mysql 做DB
前端目录: frontend
后端目录: backed
DB 目录: db

## 系统模块

### 1. 系统后台

系统后台在backend 目录，主要提供动态数据配置，生成的功能。详细功能定义如下

#### 前端数据接口
返回前端需要的动态数据，包括配置的图片文件地址，配置的文字内容。
#### 后台管理接口 
用于配置前端需要的图片和文字信息。


### 2. 系统前台

系统前台在frontend 目录，用vue 框架，通过component Id 从后端取回图片地址和文字信息

### 3. DB
提供用户信息存储，产品信息存储，订单信息， 物流信息存储功能

## 业务模块

### 1. 通用模块
Header:
所有业务模块的顶部，都有一个公司logo, 主业务模块的导航栏，用户登录按钮，在logo 下方，有一块滚动展现的公司的banner 图片，图片应该是3张连动播放。
logo 图片，主业务模块导航栏，用户登录按钮，banner 图片，这些信息，从后台的前端数据接口中获取。

Footer:
所有业务模块的底部，有一个统一的模块，分成4块，
1. 公司的信息，包括公司的地址，公司的电话，公司的邮箱，这些信息从后台的公司信息接口中获取。
2. 网站的导航栏，包括网站的首页，产品列表，关于，新闻，联系，用户模块。
3. 产品的分类，包括产品的分类名称，产品的分类描述，这些信息从产品分类列表API 获得，点击每个分类，跳到产品列表页面，显示该分类的产品。
4. 公司的社交链接，包括公司的微信，公司的微博，公司的QQ，公司的抖音，公司的小红书。这些信息从后台的公司信息接口中获取。

在最底部是网站的版权信息。

主业务模块: 包括主页面，产品列表页面，关于页面，新闻信息页面，联系页面，用户模块。

### 2. 主页面
在主页面, 主要包括以下功能
a. 展现按产品分类展现每个产品的前10 个重要产品的缩略图。点击缩略图，进入产品详情页面。
b. 展现一个简要介绍公司文化的栏目，

### 3. 产品列表页面
产品列表页面，按产品分类展示产品。

### 4. 产品详情页面
产品详情页面，展示产品的详细信息，包括产品的图片，产品的描述，产品的价格，产品的库存，产品的属性，产品的评论。
在产品详情页面，有一个询价按钮，点击询价按钮，进入询价页面。

### 5. 关于页面
关于页面，展示公司的简介，公司的历史，公司的文化，公司的团队，公司的资质，公司的荣誉。

### 6. 新闻信息页面
新闻信息页面，展示公司的新闻信息，包括公司的新闻，公司的活动，公司的优惠，公司的促销。

### 7. 联系页面
联系页面，展示公司的联系方式，包括公司的地址，公司的电话，公司的邮箱，公司的微信。

### 8. 用户模块

用户模块，包括用户登录，用户注册，用户订单管理，用户物流跟踪。

#### 用户注册模块
现在只支持用户邮箱注册，用户需要在注册页面，填入有效邮箱和他的密码，密码需要满足足够的强度，并校验是否是机器人，并勾选用户协议。 

用户必须注册后，会发激活邮件到用户邮箱中，用户必须到注册的邮箱中激活后，才能正常使用。

用户忘记密码，也必须通过注册的邮箱重置密码。

## 管理后台

管理后台，包括公司信息管理, 产品类型，产品管理，订单管理，用户管理，物流管理。

### 1. 公司信息管理

公司信息管理可以设置以下信息,
公司信息(公司地址，联系人姓名，电话，公司简介)，以及Logo图片，联系人的微信扫码图片

无论logo 和微信图片是否存在，都有上传文件功能，当图片已经存在可以预览，否则显示图片不存在的信息

公司logo图片上传后存在固定的文件地址，按照上传文件的格式，如果上传的文件是png, 则文件地址是asset/images/logo.png，如果是jpg 则文件地址是asset/images/logo.jpg, 如果文件存在，上传后就覆盖这个文件。

微信的图片上传后一样存在固定的文件地址，按照上传文件的格式，如果上传的文件是png, 则文件地址是asset/images/wechat.png，如果是jpg 则文件地址是asset/images/wechat.jpg, 如果文件存在，上传后就覆盖这个文件。

### 2. 产品分类
产品分类包括 类型名称，类型编码，排序字段，状态(上架，下架), 描述。
类型编码32 字节，必须唯一， 在添加和修改接口必须检查，如果有重复需要报错

### 3. 产品管理

产品管理，包括产品分类管理，产品管理，可以设置如下项目
a. 产品的名称, 产品的编号，产品分类，产品价格，产品库存， 产品状态(上架，下架)， 产品类型，（有两种: 代销， 自营）。
产品的编号, 用64 字节，必须唯一。 在添加和修改接口必须检查，如果有重复需要报错。 另外提供一个生成production_code 的接口给前端调用，让前端在新建一个产品的时候, 选择了一个类型之后，可以调用这个接口生成一个默认的code，这个逻辑用catergory_code 做前缀，用这个类型数量最大值做后缀

b. 产品的缩略图，产品的缩略图会用在主页和产品列表界面， 只能有一张。
c. 产品的轮播图，会在产品的详情页显示，可以有多张。
d. 产品的简介，用HTML格式存储文本信息，前端使用配置的HTML文本显示简介信息。
e. 产品详情 可以使用HTML和MarkDown存储文本和图片信息。

产品图片的逻辑，1. 主图只能传一张，轮播图可以上传多张。 2. product_images 表的product_id 可以为空，在新建一个产品的时候可以先上传图片，这个时候产品图片表里对应相应图片的产品id 是空，最后点保存的时候，把产品id 为空的图片记录才修改为正确的产品id. 

### 4. 订单管理



### 用户管理
系统应该有两类用户，一种是产品用户，是使用产品的人，他们可以下单，询价，这种用户在产品界面上可以通过邮箱，手机号注册，另外一种是管理员，管理员是系统的内置用户，首先DB 里面默认有一个admin 权限的用户，这个用户登录进去以后可以添加其他管理员。在user 表里面要有userRole 的管理。 

用户的校验机制，应该使用慢哈希加盐的方式。密码的存储方式应该是：
​步骤1：用户输入密码后，系统生成随机盐值。
​步骤2：将盐值与密码拼接（例如 salted_password = password + salt）。
​步骤3：使用哈希算法（如SHA-256、bcrypt）对拼接后的字符串进行哈希计算。
​步骤4：将盐值和哈希值一起存储到数据库中。盐值无需加密，直接明文存储即可

验证用户登录时，需从数据库提取原盐值，与用户输入的密码重新拼接并哈希，再与存储的哈希值比对。如果盐值丢失，则无法正确验证密码。

### 物流管理

 


## 登录流程
需要分开产品和管理员登录的UI 和逻辑，管理员登录需要检查user_rule 是admin。 管理员用户登录后可以访问后台管理界面，但是不能访问产品界面相关的购物车，订单信息。 
产品登录 用户必须user_rule 是user, 而且是激活用户。
当产品用户登录后可以访问购物车，他本人的订单，他本人的信息。

这两种用户登录后他们的用户Id和用户名存在JWTToken 里面，JWTToken 以Cookie存到用户机器， 对cookie 做如下设置
设置 HttpOnly标志， 禁止 JavaScript 访问cookie，防止 XSS 攻击窃取敏感信息
如果是https访问，设置 Secure 标准确保仅 HTTPS 传输，防止数据明文泄露
设置 SameSite=Strict/Lax 限制跨站请求，降低 CSRF 风险

前端服务器收到cookie, 之后把cookie 转换到http 的Authorization header 中，传输到后端。后端用一个统一的接口拦截所以的请求从Jwttoken 中去到userId信息，为后面的逻辑服务
