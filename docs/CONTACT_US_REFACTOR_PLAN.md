---
description: Contact Us åŠŸèƒ½é‡æ„æŠ€æœ¯æ–‡æ¡£
author: AI Assistant
date: 2024-03-15
version: 1.0
---

# Contact Us åŠŸèƒ½é‡æ„æŠ€æœ¯æ–‡æ¡£

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 ä¸šåŠ¡éœ€æ±‚
æ ¹æ®æœ€æ–°çš„ä¸šåŠ¡éœ€æ±‚ï¼Œè”ç³»é¡µé¢éœ€è¦å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š
- å±•ç¤ºå…¬å¸è”ç³»æ–¹å¼ï¼ˆåœ°å€ã€ç”µè¯ã€é‚®ç®±ã€å¾®ä¿¡ï¼‰
- **çµæ´»è®¿é—®**: è”ç³»è¡¨å•æ”¯æŒç™»å½•å’Œæœªç™»å½•ç”¨æˆ·è®¿é—®
- **æ™ºèƒ½å¡«å……**: ç™»å½•ç”¨æˆ·è‡ªåŠ¨å¡«å……å§“åã€é‚®ç®±ã€ç”µè¯ä¿¡æ¯ä¸”ä¸å¯ç¼–è¾‘
- **æ‰‹åŠ¨å¡«å†™**: æœªç™»å½•ç”¨æˆ·å¯æ‰‹åŠ¨å¡«å†™æ‰€æœ‰ä¿¡æ¯
- **éªŒè¯ç éªŒè¯**: æ‰€æœ‰ç”¨æˆ·æäº¤æ¶ˆæ¯å‰å¿…é¡»é€šè¿‡å›¾å½¢éªŒè¯ç éªŒè¯ï¼ˆç±»ä¼¼Register.vueä¸­çš„å®ç°ï¼‰
- **ä¸šåŠ¡ç»„åˆ†é…**: ç™»å½•ç”¨æˆ·å…³è”åˆ°å¯¹åº”ä¸šåŠ¡ç»„ï¼Œæœªç™»å½•ç”¨æˆ·ä½¿ç”¨é»˜è®¤ä¸šåŠ¡ç»„
- ç”¨æˆ·æäº¤åå°†ä¿¡æ¯å­˜å‚¨åˆ°æ•°æ®åº“ï¼ŒåŒ…å«å§“åã€é‚®ç®±ã€ç”µè¯ç­‰å®Œæ•´ä¿¡æ¯
- å®ç°ä¸šåŠ¡äººå‘˜ç®¡ç†åŠŸèƒ½ï¼Œä¸šåŠ¡äººå‘˜ä½œä¸ºç‰¹æ®Šè§’è‰²çš„ç”¨æˆ·
- å®ç°ä¸šåŠ¡ç»„ç®¡ç†ï¼Œæ¯ä¸ªç»„æœ‰ç»„åå’Œç»„é‚®ç®±
- æ™®é€šç”¨æˆ·æ³¨å†Œåè‡ªåŠ¨å…³è”åˆ°é»˜è®¤ä¸šåŠ¡ç»„
- ç”¨æˆ·æäº¤è”ç³»ä¿¡æ¯åï¼Œç³»ç»Ÿæ ¹æ®ç”¨æˆ·å…³è”çš„ä¸šåŠ¡ç»„å‘é€é‚®ä»¶åˆ°ç»„é‚®ç®±
- ç®¡ç†å‘˜å¯ä»¥ç®¡ç†ä¸šåŠ¡äººå‘˜å’Œä¸šåŠ¡ç»„
- ä¸šåŠ¡äººå‘˜ç™»å½•åå¯æŸ¥çœ‹å’Œå¤„ç†è”ç³»ä¿¡æ¯åŠè®¢å•ä¿¡æ¯
- **ç”¨æˆ·ç®¡ç†å¢å¼º**: ç®¡ç†å‘˜å¯åœ¨ç”¨æˆ·ç®¡ç†é¡µé¢æŸ¥çœ‹å’Œä¿®æ”¹æ™®é€šç”¨æˆ·çš„ä¸šåŠ¡ç»„åˆ†é…

### 1.2 å½“å‰çŠ¶æ€åˆ†æ
- âœ… å‰ç«¯é¡µé¢å·²å®ç°ï¼š`frontend/src/views/Contact.vue` (å·²æ›´æ–°æ”¯æŒnameã€emailã€phoneå­—æ®µ)
- âœ… é‚®ä»¶å‘é€å·¥å…·å·²å­˜åœ¨ï¼š`backend/utils/email.js`
- âœ… åç«¯APIæ¥å£å·²å®ç°ï¼š`backend/controllers/contactController.js`
- âœ… æ•°æ®åº“è¡¨å·²å­˜åœ¨ï¼š`contact_messages` è¡¨åŒ…å«nameã€emailã€phoneå­—æ®µ
- âœ… è·¯ç”±é…ç½®å·²å®Œæˆï¼š`backend/routes/contactRoutes.js` (æ”¯æŒå¯é€‰è®¤è¯)
- âœ… å‰ç«¯è¡¨å•æäº¤åŠŸèƒ½å·²å®Œæˆï¼šåŒ…å«éªŒè¯ç éªŒè¯
- ğŸ”„ éªŒè¯ç åŠŸèƒ½éœ€è°ƒæ•´ï¼šä»é‚®ç®±éªŒè¯ç æ”¹ä¸ºå›¾å½¢éªŒè¯ç ï¼ˆå‚è€ƒRegister.vueå®ç°ï¼‰
- âœ… ç¿»è¯‘æ–‡ä»¶å·²æ›´æ–°ï¼šæ·»åŠ äº†æ–°å­—æ®µçš„å¤šè¯­è¨€æ”¯æŒ

## 2. æŠ€æœ¯æ¶æ„è®¾è®¡

### 2.1 æŠ€æœ¯æ ˆ
- **å‰ç«¯**: Vue.js 3 + Element Plus
- **åç«¯**: Node.js + Express
- **æ•°æ®åº“**: MySQL 8.0
- **é‚®ä»¶æœåŠ¡**: Nodemailer

### 2.2 æ¨¡å—åˆ’åˆ†
```
Contact Us åŠŸèƒ½æ¨¡å—
â”œâ”€â”€ å‰ç«¯æ¨¡å—
â”‚   â”œâ”€â”€ è”ç³»è¡¨å•ç»„ä»¶ (Contact.vue)
â”‚   â”œâ”€â”€ ä¸šåŠ¡ç»„ç®¡ç†ç»„ä»¶ (BusinessGroupManagement.vue)
â”‚   â”œâ”€â”€ ä¸šåŠ¡äººå‘˜ç®¡ç†ç»„ä»¶ (BusinessStaffManagement.vue)
â”‚   â”œâ”€â”€ è”ç³»æ¶ˆæ¯ç®¡ç†ç»„ä»¶ (ContactMessageManagement.vue)
â”‚   â”œâ”€â”€ è¡¨å•éªŒè¯
â”‚   â””â”€â”€ APIè°ƒç”¨
â”œâ”€â”€ åç«¯æ¨¡å—
â”‚   â”œâ”€â”€ è”ç³»æ¶ˆæ¯æ§åˆ¶å™¨ (contactController.js)
â”‚   â”œâ”€â”€ ä¸šåŠ¡ç»„æ§åˆ¶å™¨ (businessGroupController.js)
â”‚   â”œâ”€â”€ ç”¨æˆ·ç®¡ç†æ§åˆ¶å™¨ (userManagementController.js)
â”‚   â”œâ”€â”€ è·¯ç”±é…ç½® (contactRoutes.js, businessRoutes.js)
â”‚   â”œâ”€â”€ é‚®ä»¶è·¯ç”±æœåŠ¡
â”‚   â””â”€â”€ æ•°æ®éªŒè¯
â””â”€â”€ æ•°æ®åº“æ¨¡å—
    â”œâ”€â”€ è”ç³»æ¶ˆæ¯è¡¨ (contact_messages)
    â”œâ”€â”€ ä¸šåŠ¡ç»„è¡¨ (business_groups)
    â”œâ”€â”€ ç”¨æˆ·ä¸šåŠ¡ç»„å…³è”è¡¨ (user_business_groups)
    â”œâ”€â”€ ç”¨æˆ·è¡¨æ‰©å±• (users - å¢åŠ roleå­—æ®µ)
    â””â”€â”€ ç›¸å…³ç´¢å¼•
```

## 3. æ•°æ®åº“è®¾è®¡

### 3.1 ç”¨æˆ·è¡¨æ‰©å±•

```sql
-- æ‰©å±•ç”¨æˆ·è¡¨ï¼Œå¢åŠ ä¸šåŠ¡ç»„å…³è”å­—æ®µï¼ˆç”¨æˆ·è¡¨ä¸­å·²æœ‰user_roleå­—æ®µï¼‰
ALTER TABLE users ADD COLUMN business_group_id BIGINT DEFAULT NULL COMMENT 'å…³è”çš„ä¸šåŠ¡ç»„ID';
ALTER TABLE users ADD INDEX idx_business_group_id (business_group_id);
ALTER TABLE users ADD FOREIGN KEY (business_group_id) REFERENCES business_groups(id);
```

### 3.2 ä¸šåŠ¡ç»„è¡¨ç»“æ„

```sql
-- ä¸šåŠ¡ç»„è¡¨
CREATE TABLE IF NOT EXISTS business_groups (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  guid BINARY(16) NOT NULL,
  group_name VARCHAR(64) NOT NULL COMMENT 'ä¸šåŠ¡ç»„åç§°',
  group_email VARCHAR(64) NOT NULL COMMENT 'ä¸šåŠ¡ç»„é‚®ç®±',
  description VARCHAR(256) COMMENT 'ä¸šåŠ¡ç»„æè¿°',
  is_default TINYINT(1) DEFAULT 0 COMMENT 'æ˜¯å¦ä¸ºé»˜è®¤ç»„',
  status ENUM('active', 'inactive') NOT NULL DEFAULT 'active' COMMENT 'çŠ¶æ€',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  deleted TINYINT(1) DEFAULT 0,
  
  UNIQUE KEY uk_group_name_deleted (group_name, deleted),
  UNIQUE KEY uk_group_email_deleted (group_email, deleted),
  INDEX idx_is_default (is_default),
  INDEX idx_status (status),
  INDEX idx_deleted (deleted)
) COMMENT='ä¸šåŠ¡ç»„è¡¨';
```

### 3.3 ç”¨æˆ·ä¸šåŠ¡ç»„å…³è”è¡¨

```sql
-- ç”¨æˆ·ä¸šåŠ¡ç»„å…³è”è¡¨
CREATE TABLE IF NOT EXISTS user_business_groups (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  guid BINARY(16) NOT NULL,
  user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
  business_group_id BIGINT NOT NULL COMMENT 'ä¸šåŠ¡ç»„ID',
  assigned_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ†é…æ—¶é—´',
  assigned_by BIGINT COMMENT 'åˆ†é…äººID',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  deleted TINYINT(1) DEFAULT 0,
  
  UNIQUE KEY uk_user_group_deleted (user_id, business_group_id, deleted),
  INDEX idx_user_id (user_id),
  INDEX idx_business_group_id (business_group_id),
  INDEX idx_deleted (deleted),
  
  FOREIGN KEY (user_id) REFERENCES users(id),
  FOREIGN KEY (business_group_id) REFERENCES business_groups(id),
  FOREIGN KEY (assigned_by) REFERENCES users(id)
) COMMENT='ç”¨æˆ·ä¸šåŠ¡ç»„å…³è”è¡¨';
```

### 3.4 è”ç³»æ¶ˆæ¯è¡¨ç»“æ„

```sql
-- è”ç³»æ¶ˆæ¯è¡¨ï¼ˆç®€åŒ–ç‰ˆ - ç§»é™¤nameã€emailã€phoneå­—æ®µï¼‰
CREATE TABLE IF NOT EXISTS contact_messages (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  guid BINARY(16) NOT NULL,
  user_id BIGINT NOT NULL COMMENT 'å…³è”ç”¨æˆ·IDï¼ˆå¿…é¡»ä¸ºå·²ç™»å½•ç”¨æˆ·ï¼‰',
  business_group_id BIGINT COMMENT 'å¤„ç†ä¸šåŠ¡ç»„ID',
  subject VARCHAR(128) NOT NULL COMMENT 'æ¶ˆæ¯ä¸»é¢˜',
  message TEXT NOT NULL COMMENT 'æ¶ˆæ¯å†…å®¹',
  status ENUM('pending', 'processing', 'replied', 'closed') NOT NULL DEFAULT 'pending' COMMENT 'å¤„ç†çŠ¶æ€',
  priority ENUM('low', 'normal', 'high', 'urgent') NOT NULL DEFAULT 'normal' COMMENT 'ä¼˜å…ˆçº§',
  ip_address VARCHAR(32) COMMENT 'æäº¤è€…IPåœ°å€',
  user_agent TEXT COMMENT 'ç”¨æˆ·ä»£ç†ä¿¡æ¯',
  replied_at TIMESTAMP NULL COMMENT 'å›å¤æ—¶é—´',
  replied_by BIGINT COMMENT 'å›å¤äººID',
  assigned_to BIGINT COMMENT 'åˆ†é…ç»™çš„ä¸šåŠ¡äººå‘˜ID',
  created_by BIGINT NOT NULL COMMENT 'åˆ›å»ºè€…IDï¼ˆä¸user_idç›¸åŒï¼‰',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  deleted TINYINT(1) DEFAULT 0,
  
  INDEX idx_user_id (user_id),
  INDEX idx_business_group_id (business_group_id),
  INDEX idx_status (status),
  INDEX idx_priority (priority),
  INDEX idx_assigned_to (assigned_to),
  INDEX idx_created_at (created_at),
  INDEX idx_deleted (deleted),
  
  FOREIGN KEY (user_id) REFERENCES users(id),
  FOREIGN KEY (business_group_id) REFERENCES business_groups(id),
  FOREIGN KEY (replied_by) REFERENCES users(id),
  FOREIGN KEY (assigned_to) REFERENCES users(id),
  FOREIGN KEY (created_by) REFERENCES users(id)
) COMMENT='è”ç³»æ¶ˆæ¯è¡¨ï¼ˆç®€åŒ–ç‰ˆï¼‰';
```

### 3.5 è®¾è®¡è¯´æ˜
- **éµå¾ªé¡¹ç›®è§„èŒƒ**: ä½¿ç”¨ BIGINT ä¸»é”®ã€BINARY(16) GUIDã€è½¯åˆ é™¤æœºåˆ¶
- **å­—ç¬¦ä¸²é•¿åº¦è§„èŒƒ**: æ‰€æœ‰ VARCHAR é•¿åº¦ä¸º 8 çš„å€æ•°
- **è§’è‰²ç®¡ç†**: åœ¨ç”¨æˆ·è¡¨ä¸­å¢åŠ  role å­—æ®µåŒºåˆ†ç”¨æˆ·ç±»å‹
- **ä¸šåŠ¡ç»„ç®¡ç†**: æ”¯æŒå¤šä¸šåŠ¡ç»„ï¼Œæ¯ç»„æœ‰ç‹¬ç«‹é‚®ç®±
- **é»˜è®¤ç»„æœºåˆ¶**: æ–°ç”¨æˆ·è‡ªåŠ¨åˆ†é…åˆ°é»˜è®¤ä¸šåŠ¡ç»„
- **é‚®ä»¶è·¯ç”±**: æ ¹æ®ç”¨æˆ·æ‰€å±ä¸šåŠ¡ç»„è·¯ç”±é‚®ä»¶
- **æƒé™æ§åˆ¶**: ä¸šåŠ¡äººå‘˜åªèƒ½æŸ¥çœ‹åˆ†é…ç»™è‡ªå·±ç»„çš„æ¶ˆæ¯
- **å®¡è®¡å­—æ®µ**: è®°å½• IP åœ°å€å’Œç”¨æˆ·ä»£ç†ï¼Œä¾¿äºå®‰å…¨å®¡è®¡
- **ç´¢å¼•ä¼˜åŒ–**: ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µå»ºç«‹ç´¢å¼•
- **å¤–é”®çº¦æŸ**: ç¡®ä¿æ•°æ®ä¸€è‡´æ€§

## 4. åç«¯APIè®¾è®¡

### 4.1 APIæ¥å£è§„èŒƒ

#### 4.1.1 æäº¤è”ç³»æ¶ˆæ¯
```
POST /api/contact/messages
```

**è¯·æ±‚å‚æ•°**:
```json
{
  "subject": "äº§å“å’¨è¯¢",
  "message": "æˆ‘æƒ³äº†è§£è´µå…¬å¸çš„æ±½è½¦é…ä»¶äº§å“...",
  "priority": "normal"
}
```

**è¯´æ˜**: 
- ç”¨æˆ·ä¿¡æ¯ï¼ˆnameã€emailã€phoneï¼‰é€šè¿‡JWT tokenè‡ªåŠ¨è·å–ï¼Œæ— éœ€å‰ç«¯ä¼ é€’
- **éœ€è¦ç™»å½•**: æ­¤æ¥å£éœ€è¦ç”¨æˆ·ç™»å½•ï¼Œé€šè¿‡JWTéªŒè¯ç”¨æˆ·èº«ä»½
- **è‡ªåŠ¨åˆ†é…ä¸šåŠ¡ç»„**: æ ¹æ®ç”¨æˆ·çš„business_group_idè‡ªåŠ¨åˆ†é…åˆ°å¯¹åº”ä¸šåŠ¡ç»„
- **é»˜è®¤ä¸šåŠ¡ç»„**: å¦‚æœç”¨æˆ·æœªç»‘å®šä¸šåŠ¡ç»„ï¼Œè‡ªåŠ¨åˆ†é…åˆ°é»˜è®¤ä¸šåŠ¡ç»„

**å“åº”æ ¼å¼**:
```json
{
  "success": true,
  "data": {
    "id": 1,
    "guid": "550e8400-e29b-41d4-a716-446655440000",
    "status": "pending",
    "business_group": {
      "id": 1,
      "name": "é»˜è®¤ä¸šåŠ¡ç»„",
      "email": "default@company.com"
    }
  },
  "message": "CONTACT.MESSAGE_SUBMITTED",
  "timestamp": "2024-03-15T10:30:00Z"
}
```

#### 4.1.2 ä¸šåŠ¡ç»„ç®¡ç†æ¥å£

**åˆ›å»ºä¸šåŠ¡ç»„**
```
POST /api/admin/business-groups
```

**è¯·æ±‚å‚æ•°**:
```json
{
  "group_name": "é”€å”®ç»„",
  "group_email": "sales@company.com",
  "description": "è´Ÿè´£äº§å“é”€å”®å’¨è¯¢",
  "is_default": false
}
```

**è·å–ä¸šåŠ¡ç»„åˆ—è¡¨**
```
GET /api/admin/business-groups
```

**åˆ†é…ç”¨æˆ·åˆ°ä¸šåŠ¡ç»„**
```
POST /api/admin/business-groups/{groupId}/users
```

**è¯·æ±‚å‚æ•°**:
```json
{
  "user_ids": [1, 2, 3]
}
```

#### 4.1.3 ç”¨æˆ·ç®¡ç†æ¥å£

**æ›´æ–°ç”¨æˆ·è§’è‰²**
```
PATCH /api/admin/users/{userId}/role
```

**è¯·æ±‚å‚æ•°**:
```json
{
  "role": "business_staff"
}
```

**æ›´æ–°ç”¨æˆ·ä¸šåŠ¡ç»„**
```
PATCH /api/admin/users/{userId}/business-group
```

**è¯·æ±‚å‚æ•°**:
```json
{
  "businessGroupId": 2
}
```

**è¯´æ˜**: 
- åªæœ‰ç®¡ç†å‘˜å¯ä»¥ä¿®æ”¹ç”¨æˆ·çš„ä¸šåŠ¡ç»„
- åªèƒ½ä¿®æ”¹è§’è‰²ä¸º"user"çš„æ™®é€šç”¨æˆ·çš„ä¸šåŠ¡ç»„
- businessGroupIdä¸ºnullæ—¶è¡¨ç¤ºå–æ¶ˆä¸šåŠ¡ç»„åˆ†é…

**å“åº”æ ¼å¼**:
```json
{
  "success": true,
  "message": "USER_BUSINESS_GROUP_UPDATED",
  "data": {
    "userId": 123,
    "businessGroupId": 2
  }
}
```

**è·å–ä¸šåŠ¡äººå‘˜åˆ—è¡¨**
```
GET /api/admin/users/business-staff
```

#### 4.1.4 è”ç³»æ¶ˆæ¯ç®¡ç†æ¥å£

**ç®¡ç†å‘˜è·å–æ‰€æœ‰æ¶ˆæ¯**
```
GET /api/admin/contact/messages
```

**ä¸šåŠ¡äººå‘˜è·å–åˆ†é…çš„æ¶ˆæ¯**
```
GET /api/business/contact/messages
```

**æŸ¥è¯¢å‚æ•°**:
- `page`: é¡µç  (é»˜è®¤: 1)
- `pageSize`: æ¯é¡µæ•°é‡ (é»˜è®¤: 20)
- `status`: çŠ¶æ€ç­›é€‰
- `priority`: ä¼˜å…ˆçº§ç­›é€‰
- `business_group_id`: ä¸šåŠ¡ç»„ç­›é€‰ï¼ˆç®¡ç†å‘˜å¯ç”¨ï¼‰
- `keyword`: å…³é”®è¯æœç´¢

**å“åº”æ ¼å¼**:
```json
{
  "success": true,
  "data": {
    "items": [
      {
        "id": 1,
        "name": "å¼ ä¸‰",
        "email": "zhangsan@example.com",
        "subject": "äº§å“å’¨è¯¢",
        "status": "pending",
        "priority": "normal",
        "business_group": {
          "id": 1,
          "name": "é”€å”®ç»„"
        },
        "assigned_to": {
          "id": 5,
          "name": "æä¸šåŠ¡"
        },
        "created_at": "2024-03-15T10:30:00Z"
      }
    ],
    "pagination": {
      "page": 1,
      "pageSize": 20,
      "total": 100,
      "totalPages": 5
    }
  },
  "message": "CONTACT.MESSAGE_LIST_SUCCESS",
  "timestamp": "2024-03-15T10:30:00Z"
}
```

### 4.2 æ§åˆ¶å™¨è®¾è®¡

#### 4.2.1 æ–‡ä»¶ç»“æ„
```
backend/controllers/contactController.js
backend/controllers/businessGroupController.js
backend/controllers/userManagementController.js
```

#### 4.2.2 è”ç³»æ¶ˆæ¯æ§åˆ¶å™¨ (contactController.js)
- `submitMessage()`: æäº¤è”ç³»æ¶ˆæ¯ï¼ˆè‡ªåŠ¨åˆ†é…ä¸šåŠ¡ç»„ï¼‰
- `getMessageList()`: è·å–æ¶ˆæ¯åˆ—è¡¨ï¼ˆç®¡ç†å‘˜/ä¸šåŠ¡äººå‘˜ï¼‰
- `getMessageDetail()`: è·å–æ¶ˆæ¯è¯¦æƒ…
- `updateMessageStatus()`: æ›´æ–°æ¶ˆæ¯çŠ¶æ€
- `assignMessage()`: åˆ†é…æ¶ˆæ¯ç»™ä¸šåŠ¡äººå‘˜
- `deleteMessage()`: åˆ é™¤æ¶ˆæ¯ï¼ˆç®¡ç†å‘˜ï¼‰

#### 4.2.3 ä¸šåŠ¡ç»„æ§åˆ¶å™¨ (businessGroupController.js)
- `createGroup()`: åˆ›å»ºä¸šåŠ¡ç»„
- `getGroupList()`: è·å–ä¸šåŠ¡ç»„åˆ—è¡¨
- `updateGroup()`: æ›´æ–°ä¸šåŠ¡ç»„ä¿¡æ¯
- `deleteGroup()`: åˆ é™¤ä¸šåŠ¡ç»„
- `assignUsersToGroup()`: åˆ†é…ç”¨æˆ·åˆ°ä¸šåŠ¡ç»„
- `removeUsersFromGroup()`: ä»ä¸šåŠ¡ç»„ç§»é™¤ç”¨æˆ·
- `setDefaultGroup()`: è®¾ç½®é»˜è®¤ä¸šåŠ¡ç»„

#### 4.2.4 ç”¨æˆ·ç®¡ç†æ§åˆ¶å™¨ (userManagementController.js)
- `updateUserRole()`: æ›´æ–°ç”¨æˆ·è§’è‰²
- `getBusinessStaffList()`: è·å–ä¸šåŠ¡äººå‘˜åˆ—è¡¨
- `getUserBusinessGroups()`: è·å–ç”¨æˆ·æ‰€å±ä¸šåŠ¡ç»„
- `createBusinessStaff()`: åˆ›å»ºä¸šåŠ¡äººå‘˜è´¦æˆ·

### 4.3 è·¯ç”±é…ç½®

#### 4.3.1 æ–‡ä»¶ç»“æ„
```
backend/routes/contactRoutes.js
backend/routes/businessRoutes.js
backend/routes/userManagementRoutes.js
```

#### 4.3.2 è”ç³»æ¶ˆæ¯è·¯ç”± (contactRoutes.js)
```javascript
// å…¬å¼€æ¥å£
router.post('/messages', contactController.submitMessage);

// ç®¡ç†å‘˜æ¥å£
router.get('/admin/messages', jwt.verifyToken, jwt.requireAdmin, contactController.getMessageList);
router.get('/admin/messages/:id', jwt.verifyToken, jwt.requireAdmin, contactController.getMessageDetail);
router.patch('/admin/messages/:id/status', jwt.verifyToken, jwt.requireAdmin, contactController.updateMessageStatus);
router.patch('/admin/messages/:id/assign', jwt.verifyToken, jwt.requireAdmin, contactController.assignMessage);
router.delete('/admin/messages/:id', jwt.verifyToken, jwt.requireAdmin, contactController.deleteMessage);

// ä¸šåŠ¡äººå‘˜æ¥å£
router.get('/business/messages', jwt.verifyToken, jwt.requireBusinessStaff, contactController.getMessageList);
router.get('/business/messages/:id', jwt.verifyToken, jwt.requireBusinessStaff, contactController.getMessageDetail);
router.patch('/business/messages/:id/status', jwt.verifyToken, jwt.requireBusinessStaff, contactController.updateMessageStatus);
```

#### 4.3.3 ä¸šåŠ¡ç»„è·¯ç”± (businessRoutes.js)
```javascript
// ç®¡ç†å‘˜æ¥å£
router.post('/admin/business-groups', jwt.verifyToken, jwt.requireAdmin, businessGroupController.createGroup);
router.get('/admin/business-groups', jwt.verifyToken, jwt.requireAdmin, businessGroupController.getGroupList);
router.patch('/admin/business-groups/:id', jwt.verifyToken, jwt.requireAdmin, businessGroupController.updateGroup);
router.delete('/admin/business-groups/:id', jwt.verifyToken, jwt.requireAdmin, businessGroupController.deleteGroup);
router.post('/admin/business-groups/:id/users', jwt.verifyToken, jwt.requireAdmin, businessGroupController.assignUsersToGroup);
router.delete('/admin/business-groups/:id/users', jwt.verifyToken, jwt.requireAdmin, businessGroupController.removeUsersFromGroup);
router.patch('/admin/business-groups/:id/default', jwt.verifyToken, jwt.requireAdmin, businessGroupController.setDefaultGroup);
```

#### 4.3.4 ç”¨æˆ·ç®¡ç†è·¯ç”± (userManagementRoutes.js)
```javascript
// ç®¡ç†å‘˜æ¥å£
router.patch('/admin/users/:id/role', jwt.verifyToken, jwt.requireAdmin, userManagementController.updateUserRole);
router.get('/admin/users/business-staff', jwt.verifyToken, jwt.requireAdmin, userManagementController.getBusinessStaffList);
router.get('/admin/users/:id/business-groups', jwt.verifyToken, jwt.requireAdmin, userManagementController.getUserBusinessGroups);
router.post('/admin/users/business-staff', jwt.verifyToken, jwt.requireAdmin, userManagementController.createBusinessStaff);
```

## 5. å‰ç«¯å®ç°è®¾è®¡

### 5.1 ç»„ä»¶é‡æ„

#### 5.1.1 Contact.vue ä¼˜åŒ–
- **APIé›†æˆ**: å°†æ¨¡æ‹Ÿæäº¤æ”¹ä¸ºçœŸå®APIè°ƒç”¨
- **é”™è¯¯å¤„ç†**: ä½¿ç”¨ `$messageHandler` ç»Ÿä¸€å¤„ç†é”™è¯¯ï¼ˆå·²åˆ é™¤ ErrorMessage.vue ç»„ä»¶ï¼Œç»Ÿä¸€ä½¿ç”¨ messageHandler.jsï¼‰
- **è¡¨å•éªŒè¯**: å¢å¼ºå®¢æˆ·ç«¯éªŒè¯è§„åˆ™
- **ç”¨æˆ·ä½“éªŒ**: æ·»åŠ æäº¤çŠ¶æ€æŒ‡ç¤ºå™¨
- **æ¶ˆæ¯æ˜¾ç¤º**: æ‰€æœ‰æˆåŠŸã€é”™è¯¯ã€è­¦å‘Šæ¶ˆæ¯å‡é€šè¿‡ `$messageHandler` å¤„ç†ï¼Œæ”¯æŒå›½é™…åŒ–

#### 5.1.2 ç»„ä»¶ç»“æ„è®¾è®¡ï¼ˆç®€åŒ–ç‰ˆ - ä»…ç™»å½•ç”¨æˆ·ï¼‰
```vue
<template>
  <div class="contact-page">
    <!-- ä½¿ç”¨é€šç”¨é¡µé¢æ¨ªå¹…ç»„ä»¶ -->
    <PageBanner :title="$t('contact.title', 'Contact Us')" :breadcrumb="breadcrumbItems" />
    
    <!-- ç™»å½•æ£€æŸ¥ -->
    <div v-if="!isLoggedIn" class="login-required">
      <div class="container">
        <el-alert
          :title="$t('contact.loginRequired')"
          type="warning"
          :description="$t('contact.loginRequiredDesc')"
          show-icon
          :closable="false"
        />
        <div class="login-actions">
          <el-button type="primary" @click="$router.push('/login')">
            {{ $t('auth.login') }}
          </el-button>
          <el-button @click="$router.push('/register')">
            {{ $t('auth.register') }}
          </el-button>
        </div>
      </div>
    </div>
    
    <!-- è”ç³»ä¿¡æ¯å±•ç¤ºï¼ˆä»…ç™»å½•ç”¨æˆ·å¯è§ï¼‰ -->
    <div v-else class="contact-info-section">
      <div class="container">
        <!-- æ˜¾ç¤ºå½“å‰ç”¨æˆ·ä¿¡æ¯ -->
        <div class="user-info">
          <el-tag type="info">{{ $t('contact.currentUser') }}: {{ userInfo.name }} ({{ userInfo.email }})</el-tag>
        </div>
        
        <div class="contact-info-grid">
          <div class="info-item">
            <h3>{{ $t('contact.info.address', 'Address') }}</h3>
            <p>{{ companyInfo.address || defaultAddress }}</p>
          </div>
          <div class="info-item">
            <h3>{{ $t('contact.info.phone', 'Phone') }}</h3>
            <p>{{ companyInfo.phone || defaultPhone }}</p>
          </div>
          <div class="info-item">
            <h3>{{ $t('contact.info.email', 'Email') }}</h3>
            <p>{{ companyInfo.email || defaultEmail }}</p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- è”ç³»è¡¨å•ï¼ˆä»…ç™»å½•ç”¨æˆ·å¯è§ï¼Œç®€åŒ–ç‰ˆï¼‰ -->
    <div v-if="isLoggedIn" class="contact-form-section">
      <div class="container">
        <el-form ref="contactForm" :model="contactForm" :rules="contactRules" class="contact-form">
          <!-- ä¸»é¢˜ -->
          <div class="form-row">
            <div class="form-col-full">
              <FormInput
                v-model="contactForm.subject"
                :placeholder="$t('contact.form.subject.placeholder', 'Subject')"
                :label="$t('contact.form.subject.label', 'Subject')"
                required
              />
            </div>
          </div>
          
          <!-- æ¶ˆæ¯å†…å®¹ -->
          <div class="form-row">
            <div class="form-col-full">
              <el-input
                v-model="contactForm.message"
                type="textarea"
                :rows="6"
                :placeholder="$t('contact.form.message.placeholder', 'Your Message')"
                class="form-textarea"
                maxlength="2000"
                show-word-limit
              />
            </div>
          </div>
          
          <!-- ä¼˜å…ˆçº§ -->
          <div class="form-row">
            <div class="form-col">
              <el-form-item :label="$t('contact.priority')" prop="priority">
                <el-select v-model="contactForm.priority" :placeholder="$t('contact.selectPriority')">
                  <el-option :label="$t('contact.priorityLow')" value="low" />
                  <el-option :label="$t('contact.priorityNormal')" value="normal" />
                  <el-option :label="$t('contact.priorityHigh')" value="high" />
                  <el-option :label="$t('contact.priorityUrgent')" value="urgent" />
                </el-select>
              </el-form-item>
            </div>
          </div>
          
          <div class="form-actions">
            <el-button type="primary" @click="submitForm" :loading="submitting" class="submit-btn">
              {{ $t('contact.form.submit', 'Send Message') }}
            </el-button>
            <el-button @click="resetForm" class="reset-btn">
              {{ $t('contact.form.reset', 'Reset') }}
            </el-button>
          </div>
        </el-form>
      </div>
    </div>
  </div>
</template>
```

#### 5.1.3 è¡¨å•éªŒè¯è§„åˆ™ï¼ˆç®€åŒ–ç‰ˆï¼‰
```javascript
contactRules: {
  subject: [
    { required: true, message: this.$t('validation.subjectRequired'), trigger: 'blur' },
    { min: 2, max: 128, message: this.$t('validation.subjectLength'), trigger: 'blur' }
  ],
  message: [
    { required: true, message: this.$t('validation.messageRequired'), trigger: 'blur' },
    { min: 10, max: 2000, message: this.$t('validation.messageLength'), trigger: 'blur' }
  ],
  priority: [
    { required: true, message: this.$t('validation.priorityRequired'), trigger: 'change' }
  ]
}

// æ³¨æ„ï¼šç§»é™¤äº†nameã€emailã€phoneå­—æ®µçš„éªŒè¯è§„åˆ™
// ç”¨æˆ·ä¿¡æ¯é€šè¿‡JWT tokenè‡ªåŠ¨è·å–
```

### 5.2 APIè°ƒç”¨å®ç°

```javascript
async submitForm() {
  try {
    // ç™»å½•çŠ¶æ€æ£€æŸ¥
    if (!this.isLoggedIn) {
      this.$messageHandler.showWarning(
        this.$t('contact.loginRequired'),
        'contact.loginRequired'
      );
      this.$router.push('/login');
      return;
    }
    
    this.submitting = true;
    
    const valid = await this.$refs.contactForm.validate();
    if (!valid) return;
    
    const response = await this.$api.post('contact/messages', this.contactForm);
    
    this.$messageHandler.showSuccess(
      this.$t('contact.success.messageSubmitted'), 
      'contact.success.messageSubmitted'
    );
    
    this.resetForm();
  } catch (error) {
    if (error.status === 401) {
      this.$messageHandler.showWarning(
        this.$t('auth.sessionExpired'),
        'auth.sessionExpired'
      );
      this.$router.push('/login');
    } else {
      this.$messageHandler.showError(error, 'contact.error.submitFailed');
    }
  } finally {
    this.submitting = false;
  }
}

// è®¡ç®—å±æ€§
computed: {
  isLoggedIn() {
    return this.$store.getters['auth/isAuthenticated'];
  },
  userInfo() {
    return this.$store.getters['auth/userInfo'];
  }
}

// æ³¨æ„ï¼šé¡¹ç›®å·²ç»Ÿä¸€ä½¿ç”¨ messageHandler.js å¤„ç†æ‰€æœ‰æ¶ˆæ¯æ˜¾ç¤º
// ErrorMessage.vue ç»„ä»¶å·²è¢«åˆ é™¤ï¼Œæ‰€æœ‰ç»„ä»¶åº”ä½¿ç”¨ $messageHandler å…¨å±€æ–¹æ³•
// æ”¯æŒçš„æ–¹æ³•ï¼šshowSuccess, showError, showWarning, showInfo, confirm ç­‰
```

## 6. é‚®ä»¶æœåŠ¡è®¾è®¡

### 6.1 å¤šè¯­è¨€é‚®ä»¶æ¨¡æ¿è®¾è®¡

#### 6.1.1 é‚®ä»¶æ¨¡æ¿ç”Ÿæˆå™¨
```javascript
// backend/utils/emailTemplates.js
const { getTranslation } = require('./translationService');

// ç”Ÿæˆç®¡ç†å‘˜é€šçŸ¥é‚®ä»¶
function generateAdminNotificationTemplate(contactData, businessGroup, language = 'en') {
  const translations = {
    subject: getTranslation('email.admin.notification.subject', language, 'New Contact Message'),
    title: getTranslation('email.admin.notification.title', language, 'You have received a new contact message'),
    sender: getTranslation('email.admin.notification.sender', language, 'Sender'),
    email: getTranslation('email.admin.notification.email', language, 'Email'),
    phone: getTranslation('email.admin.notification.phone', language, 'Phone'),
    subject_label: getTranslation('email.admin.notification.subject_label', language, 'Subject'),
    message: getTranslation('email.admin.notification.message', language, 'Message'),
    time: getTranslation('email.admin.notification.time', language, 'Submitted at'),
    group: getTranslation('email.admin.notification.group', language, 'Business Group')
  };
  
  return `
    <!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>${translations.subject}</title>
    </head>
    <body style="font-family: Arial, sans-serif; line-height: 1.6; color: #333;">
        <div style="max-width: 600px; margin: 0 auto; padding: 20px;">
            <h2 style="color: #e53e3e;">${translations.title}</h2>
            <div style="background: #f7fafc; padding: 20px; border-radius: 8px; margin: 20px 0;">
                <p><strong>${translations.sender}:</strong> ${contactData.name}</p>
                <p><strong>${translations.email}:</strong> ${contactData.email}</p>
                <p><strong>${translations.phone}:</strong> ${contactData.phone || 'N/A'}</p>
                <p><strong>${translations.subject_label}:</strong> ${contactData.subject}</p>
                <p><strong>${translations.group}:</strong> ${businessGroup.name}</p>
                <p><strong>${translations.message}:</strong></p>
                <div style="background: white; padding: 15px; border-radius: 4px; margin-top: 10px;">
                    ${contactData.message}
                </div>
                <p><strong>${translations.time}:</strong> ${new Date(contactData.created_at).toLocaleString()}</p>
            </div>
        </div>
    </body>
    </html>
  `;
}

// ç”Ÿæˆç”¨æˆ·ç¡®è®¤é‚®ä»¶
function generateUserConfirmationTemplate(contactData, companyInfo, language = 'en') {
  const translations = {
    subject: getTranslation('email.user.confirmation.subject', language, 'Thank you for contacting us'),
    title: getTranslation('email.user.confirmation.title', language, 'Thank you for contacting us'),
    greeting: getTranslation('email.user.confirmation.greeting', language, 'Dear'),
    received: getTranslation('email.user.confirmation.received', language, 'We have received your message and our team will respond within 24 hours.'),
    your_message: getTranslation('email.user.confirmation.your_message', language, 'Your message'),
    subject_label: getTranslation('email.user.confirmation.subject_label', language, 'Subject'),
    urgent: getTranslation('email.user.confirmation.urgent', language, 'For urgent matters, please call directly'),
    thanks: getTranslation('email.user.confirmation.thanks', language, 'Thank you!')
  };
  
  return `
    <!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>${translations.subject}</title>
    </head>
    <body style="font-family: Arial, sans-serif; line-height: 1.6; color: #333;">
        <div style="max-width: 600px; margin: 0 auto; padding: 20px;">
            <h2 style="color: #e53e3e;">${translations.title}</h2>
            <p>${translations.greeting} ${contactData.name},</p>
            <p>${translations.received}</p>
            <div style="background: #f7fafc; padding: 20px; border-radius: 8px; margin: 20px 0;">
                <p><strong>${translations.your_message}:</strong></p>
                <p><strong>${translations.subject_label}:</strong> ${contactData.subject}</p>
                <div style="background: white; padding: 15px; border-radius: 4px; margin-top: 10px;">
                    ${contactData.message}
                </div>
            </div>
            <p>${translations.urgent}: ${companyInfo.phone}</p>
            <p>${translations.thanks}</p>
        </div>
    </body>
    </html>
  `;
}

module.exports = {
  generateAdminNotificationTemplate,
  generateUserConfirmationTemplate
};
```

### 6.2 é‚®ä»¶è·¯ç”±æœåŠ¡

#### 6.2.1 æœåŠ¡å‡½æ•°è®¾è®¡
```javascript
// backend/utils/contactEmailService.js
class ContactEmailService {
  // æ ¹æ®ç”¨æˆ·ä¸šåŠ¡ç»„å‘é€æ–°æ¶ˆæ¯é€šçŸ¥
  async sendNewMessageNotification(messageData) {
    try {
      // è·å–ç”¨æˆ·æ‰€å±ä¸šåŠ¡ç»„
      const businessGroup = await this.getUserBusinessGroup(messageData.user_id || messageData.email);
      
      // å‘é€åˆ°ä¸šåŠ¡ç»„é‚®ç®±
      if (businessGroup && businessGroup.group_email) {
        await this.sendEmailToGroup(businessGroup.group_email, messageData);
      } else {
        // å‘é€åˆ°é»˜è®¤ä¸šåŠ¡ç»„
        const defaultGroup = await this.getDefaultBusinessGroup();
        await this.sendEmailToGroup(defaultGroup.group_email, messageData);
      }
    } catch (error) {
      console.error('Failed to send notification:', error);
      throw error;
    }
  }
  
  // å‘é€è‡ªåŠ¨å›å¤ç»™ç”¨æˆ·
  async sendAutoReply(messageData) {
    // å®ç°è‡ªåŠ¨å›å¤é€»è¾‘
  }
  
  // è·å–ç”¨æˆ·ä¸šåŠ¡ç»„
  async getUserBusinessGroup(userIdOrEmail) {
    // æŸ¥è¯¢ç”¨æˆ·æ‰€å±ä¸šåŠ¡ç»„
  }
  
  // è·å–é»˜è®¤ä¸šåŠ¡ç»„
  async getDefaultBusinessGroup() {
    // æŸ¥è¯¢é»˜è®¤ä¸šåŠ¡ç»„
  }
  
  // å‘é€é‚®ä»¶åˆ°ä¸šåŠ¡ç»„
  async sendEmailToGroup(groupEmail, messageData) {
    // å®ç°é‚®ä»¶å‘é€é€»è¾‘
  }
  
  // ç”¨æˆ·æ³¨å†Œæ—¶è‡ªåŠ¨åˆ†é…åˆ°é»˜è®¤ä¸šåŠ¡ç»„
  async assignUserToDefaultGroup(userId) {
    const defaultGroup = await this.getDefaultBusinessGroup();
    if (defaultGroup) {
      await this.assignUserToGroup(userId, defaultGroup.id);
    }
  }
}
```

## 7. å›½é™…åŒ–æ”¯æŒ

### 7.1 æ¶ˆæ¯é”®å®šä¹‰

#### 7.1.1 åç«¯æ¶ˆæ¯é”® (backend/config/messages.js)
```javascript
CONTACT: {
  MESSAGE_SUBMITTED: 'Message submitted successfully',
  MESSAGE_SUBMIT_FAILED: 'Failed to submit message',
  MESSAGE_LIST_SUCCESS: 'Message list retrieved successfully',
  MESSAGE_LIST_FAILED: 'Failed to retrieve message list',
  MESSAGE_NOT_FOUND: 'Message not found',
  MESSAGE_UPDATE_SUCCESS: 'Message updated successfully',
  MESSAGE_DELETE_SUCCESS: 'Message deleted successfully',
  MESSAGE_ASSIGNED_SUCCESS: 'Message assigned successfully',
  VALIDATION_FAILED: 'Message validation failed',
  EMAIL_SEND_FAILED: 'Failed to send notification email',
  INVALID_EMAIL: 'Invalid email address',
  INVALID_PHONE: 'Invalid phone number',
  MESSAGE_TOO_SHORT: 'Message is too short',
  MESSAGE_TOO_LONG: 'Message is too long',
  SUBJECT_REQUIRED: 'Subject is required',
  NAME_REQUIRED: 'Name is required',
  EMAIL_REQUIRED: 'Email is required',
  MESSAGE_REQUIRED: 'Message is required',
  RATE_LIMIT_EXCEEDED: 'Too many submissions, please try again later',
  EMAIL_SEND_SUCCESS: 'Notification emails sent successfully'
},
BUSINESS_GROUP: {
  GROUP_CREATED: 'Business group created successfully',
  GROUP_UPDATED: 'Business group updated successfully',
  GROUP_DELETED: 'Business group deleted successfully',
  GROUP_NOT_FOUND: 'Business group not found',
  GROUP_LIST_SUCCESS: 'Business group list retrieved successfully',
  USER_ASSIGNED: 'Users assigned to group successfully',
  USER_REMOVED: 'Users removed from group successfully',
  DEFAULT_GROUP_SET: 'Default group set successfully',
  CANNOT_DELETE_DEFAULT: 'Cannot delete default business group',
  NAME_REQUIRED: 'Business group name is required',
  ADMIN_EMAILS_REQUIRED: 'Admin emails are required',
  INVALID_EMAIL_FORMAT: 'Invalid email format in admin emails',
  DUPLICATE_NAME: 'Business group name already exists'
},
USER_MANAGEMENT: {
  ROLE_UPDATED: 'User role updated successfully',
  ROLE_UPDATE_FAILED: 'Failed to update user role',
  BUSINESS_STAFF_LIST_SUCCESS: 'Business staff list retrieved successfully',
  BUSINESS_STAFF_CREATED: 'Business staff created successfully',
  INSUFFICIENT_PERMISSIONS: 'Insufficient permissions for this operation'
},
USER_BUSINESS_GROUP: {
  ASSIGN_SUCCESS: 'User assigned to business group successfully',
  REMOVE_SUCCESS: 'User removed from business group successfully',
  ASSIGNMENT_EXISTS: 'User is already assigned to this business group',
  ASSIGNMENT_NOT_FOUND: 'User business group assignment not found'
}
```

#### 7.1.2 æ•°æ®åº“ç¿»è¯‘æ•°æ®
```sql
-- è”ç³»è¡¨å•ç›¸å…³ç¿»è¯‘
INSERT INTO translations (guid, message_key, language_code, translation) VALUES
-- æˆåŠŸæ¶ˆæ¯
(UNHEX(REPLACE(UUID(), '-', '')), 'contact.success.messageSubmitted', 'en', 'Your message has been submitted successfully! We will contact you within 24 hours.'),
(UNHEX(REPLACE(UUID(), '-', '')), 'contact.success.messageSubmitted', 'zh-CN', 'æ‚¨çš„ç•™è¨€å·²æˆåŠŸæäº¤ï¼æˆ‘ä»¬å°†åœ¨24å°æ—¶å†…ä¸æ‚¨è”ç³»ã€‚'),

-- é”™è¯¯æ¶ˆæ¯
(UNHEX(REPLACE(UUID(), '-', '')), 'contact.error.submitFailed', 'en', 'Failed to submit message, please try again later.'),
(UNHEX(REPLACE(UUID(), '-', '')), 'contact.error.submitFailed', 'zh-CN', 'ç•™è¨€æäº¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚'),

-- é¡µé¢æ ‡é¢˜å’Œå¯¼èˆª
(UNHEX(REPLACE(UUID(), '-', '')), 'contact.title', 'en', 'Contact Us'),
(UNHEX(REPLACE(UUID(), '-', '')), 'contact.title', 'zh-CN', 'è”ç³»æˆ‘ä»¬'),
(UNHEX(REPLACE(UUID(), '-', '')), 'contact.breadcrumb.home', 'en', 'Home'),
(UNHEX(REPLACE(UUID(), '-', '')), 'contact.breadcrumb.home', 'zh-CN', 'é¦–é¡µ'),

-- è”ç³»ä¿¡æ¯æ ‡ç­¾
(UNHEX(REPLACE(UUID(), '-', '')), 'contact.info.address', 'en', 'Address'),
(UNHEX(REPLACE(UUID(), '-', '')), 'contact.info.address', 'zh-CN', 'åœ°å€'),
(UNHEX(REPLACE(UUID(), '-', '')), 'contact.info.phone', 'en', 'Phone'),
(UNHEX(REPLACE(UUID(), '-', '')), 'contact.info.phone', 'zh-CN', 'ç”µè¯'),
(UNHEX(REPLACE(UUID(), '-', '')), 'contact.info.email', 'en', 'Email'),
(UNHEX(REPLACE(UUID(), '-', '')), 'contact.info.email', 'zh-CN', 'é‚®ç®±'),

-- è¡¨å•å­—æ®µæ ‡ç­¾å’Œå ä½ç¬¦
(UNHEX(REPLACE(UUID(), '-', '')), 'contact.form.name.label', 'en', 'Name'),
(UNHEX(REPLACE(UUID(), '-', '')), 'contact.form.name.label', 'zh-CN', 'å§“å'),
(UNHEX(REPLACE(UUID(), '-', '')), 'contact.form.name.placeholder', 'en', 'Your Name'),
(UNHEX(REPLACE(UUID(), '-', '')), 'contact.form.name.placeholder', 'zh-CN', 'è¯·è¾“å…¥æ‚¨çš„å§“å'),

-- éªŒè¯æ¶ˆæ¯
(UNHEX(REPLACE(UUID(), '-', '')), 'validation.nameRequired', 'en', 'Name is required'),
(UNHEX(REPLACE(UUID(), '-', '')), 'validation.nameRequired', 'zh-CN', 'å§“åä¸ºå¿…å¡«é¡¹'),
(UNHEX(REPLACE(UUID(), '-', '')), 'validation.nameLength', 'en', 'Name must be between 2 and 32 characters'),
(UNHEX(REPLACE(UUID(), '-', '')), 'validation.nameLength', 'zh-CN', 'å§“åé•¿åº¦å¿…é¡»åœ¨2-32ä¸ªå­—ç¬¦ä¹‹é—´'),
(UNHEX(REPLACE(UUID(), '-', '')), 'validation.subjectRequired', 'en', 'Subject is required'),
(UNHEX(REPLACE(UUID(), '-', '')), 'validation.subjectRequired', 'zh-CN', 'ä¸»é¢˜ä¸ºå¿…å¡«é¡¹'),
(UNHEX(REPLACE(UUID(), '-', '')), 'validation.subjectLength', 'en', 'Subject cannot exceed 128 characters'),
(UNHEX(REPLACE(UUID(), '-', '')), 'validation.subjectLength', 'zh-CN', 'ä¸»é¢˜ä¸èƒ½è¶…è¿‡128ä¸ªå­—ç¬¦'),
(UNHEX(REPLACE(UUID(), '-', '')), 'validation.messageMinLength', 'en', 'Message must be at least 10 characters'),
(UNHEX(REPLACE(UUID(), '-', '')), 'validation.messageMinLength', 'zh-CN', 'ç•™è¨€å†…å®¹è‡³å°‘éœ€è¦10ä¸ªå­—ç¬¦'),

-- é‚®ä»¶æ¨¡æ¿ç¿»è¯‘
(UNHEX(REPLACE(UUID(), '-', '')), 'email.admin.notification.subject', 'en', 'New Contact Message'),
(UNHEX(REPLACE(UUID(), '-', '')), 'email.admin.notification.subject', 'zh-CN', 'æ–°çš„è”ç³»æ¶ˆæ¯'),
(UNHEX(REPLACE(UUID(), '-', '')), 'email.user.confirmation.subject', 'en', 'Thank you for contacting us'),
(UNHEX(REPLACE(UUID(), '-', '')), 'email.user.confirmation.subject', 'zh-CN', 'æ„Ÿè°¢æ‚¨è”ç³»æˆ‘ä»¬');
```

#### 7.1.3 ç¿»è¯‘æœåŠ¡å·¥å…·å‡½æ•°
```javascript
// backend/utils/translationService.js
const db = require('../db/db');

// ä»æ•°æ®åº“è·å–ç¿»è¯‘
async function getTranslation(key, language = 'en', fallback = '') {
  try {
    const query = `
      SELECT translation 
      FROM translations 
      WHERE message_key = ? AND language_code = ? AND deleted = 0
      LIMIT 1
    `;
    
    const [rows] = await db.execute(query, [key, language]);
    
    if (rows.length > 0) {
      return rows[0].translation;
    }
    
    // å¦‚æœæ²¡æ‰¾åˆ°æŒ‡å®šè¯­è¨€çš„ç¿»è¯‘ï¼Œå°è¯•è·å–è‹±æ–‡ç¿»è¯‘
    if (language !== 'en') {
      const [enRows] = await db.execute(query, [key, 'en']);
      if (enRows.length > 0) {
        return enRows[0].translation;
      }
    }
    
    // å¦‚æœéƒ½æ²¡æ‰¾åˆ°ï¼Œè¿”å›fallback
    return fallback;
  } catch (error) {
    console.error('Translation service error:', error);
    return fallback;
  }
}

// æ‰¹é‡è·å–ç¿»è¯‘
async function getTranslations(keys, language = 'en') {
  try {
    const placeholders = keys.map(() => '?').join(',');
    const query = `
      SELECT message_key, translation 
      FROM translations 
      WHERE message_key IN (${placeholders}) AND language_code = ? AND deleted = 0
    `;
    
    const [rows] = await db.execute(query, [...keys, language]);
    
    const translations = {};
    rows.forEach(row => {
      translations[row.message_key] = row.translation;
    });
    
    return translations;
  } catch (error) {
    console.error('Batch translation service error:', error);
    return {};
  }
}

module.exports = {
  getTranslation,
  getTranslations
};
```

## 8. å®‰å…¨è®¾è®¡

### 8.1 å•å…ƒæµ‹è¯•è®¾è®¡

#### 8.1.1 åç«¯æµ‹è¯•

**æ§åˆ¶å™¨æµ‹è¯•**
```javascript
// backend/tests/controllers/contactController.test.js
const request = require('supertest');
const app = require('../../server');
const db = require('../../db/db');
const { MESSAGES } = require('../../config/messages');

describe('Contact Controller', () => {
  beforeEach(async () => {
    // æ¸…ç†æµ‹è¯•æ•°æ®
    await db.execute('DELETE FROM contact_messages WHERE email LIKE "%test%"');
  });

  describe('POST /api/contact/messages', () => {
    it('åº”è¯¥æˆåŠŸæäº¤è”ç³»æ¶ˆæ¯', async () => {
      const contactData = {
        name: 'Test User',
        email: 'test@example.com',
        phone: '+1234567890',
        subject: 'Test Subject',
        message: 'This is a test message with sufficient length.'
      };

      const response = await request(app)
        .post('/api/contact/messages')
        .send(contactData)
        .expect(200);

      expect(response.body.success).toBe(true);
      expect(response.body.message).toBe(MESSAGES.CONTACT.MESSAGE_SUBMITTED);
    });

    it('åº”è¯¥éªŒè¯å¿…å¡«å­—æ®µ', async () => {
      const invalidData = {
        email: 'test@example.com'
        // ç¼ºå°‘å¿…å¡«å­—æ®µ
      };

      const response = await request(app)
        .post('/api/contact/messages')
        .send(invalidData)
        .expect(400);

      expect(response.body.success).toBe(false);
    });
  });
});
```

**ä¸šåŠ¡ç»„ç®¡ç†æµ‹è¯•**
```javascript
// backend/tests/controllers/businessGroupController.test.js
const request = require('supertest');
const app = require('../../server');
const { generateAdminToken } = require('../helpers/authHelper');

describe('Business Group Controller', () => {
  let adminToken;

  beforeAll(async () => {
    adminToken = await generateAdminToken();
  });

  describe('POST /api/admin/business-groups', () => {
    it('åº”è¯¥æˆåŠŸåˆ›å»ºä¸šåŠ¡ç»„', async () => {
      const groupData = {
        group_name: 'Test Group',
        group_email: 'test@company.com',
        description: 'Test Description'
      };

      const response = await request(app)
        .post('/api/admin/business-groups')
        .set('Authorization', `Bearer ${adminToken}`)
        .send(groupData)
        .expect(201);

      expect(response.body.success).toBe(true);
      expect(response.body.data.group_name).toBe(groupData.group_name);
    });
  });
});
```

#### 8.1.2 å‰ç«¯æµ‹è¯•

**ç»„ä»¶æµ‹è¯•**
```javascript
// frontend/tests/components/Contact.test.js
import { mount } from '@vue/test-utils';
import Contact from '@/views/Contact.vue';
import { ElForm, ElFormItem, ElInput, ElButton } from 'element-plus';

describe('Contact.vue', () => {
  let wrapper;

  beforeEach(() => {
    wrapper = mount(Contact, {
      global: {
        components: {
          ElForm,
          ElFormItem,
          ElInput,
          ElButton
        },
        mocks: {
          $t: (key) => key,
          $api: {
            post: jest.fn()
          },
          $messageHandler: {
            showSuccess: jest.fn(),
            showError: jest.fn()
          }
        }
      }
    });
  });

  it('åº”è¯¥æ¸²æŸ“æ‰€æœ‰è¡¨å•å­—æ®µ', () => {
    expect(wrapper.find('input[placeholder*="name"]').exists()).toBe(true);
    expect(wrapper.find('input[placeholder*="email"]').exists()).toBe(true);
    expect(wrapper.find('input[placeholder*="subject"]').exists()).toBe(true);
    expect(wrapper.find('textarea[placeholder*="message"]').exists()).toBe(true);
  });

  it('åº”è¯¥éªŒè¯å¿…å¡«å­—æ®µ', async () => {
    const submitButton = wrapper.find('.submit-btn');
    await submitButton.trigger('click');

    // éªŒè¯è¡¨å•éªŒè¯è¢«è§¦å‘
    expect(wrapper.vm.$refs.contactForm.validate).toBeDefined();
  });
});
```

### 8.2 è¾“å…¥éªŒè¯
- **XSSé˜²æŠ¤**: å¯¹æ‰€æœ‰ç”¨æˆ·è¾“å…¥è¿›è¡ŒHTMLè½¬ä¹‰
- **SQLæ³¨å…¥é˜²æŠ¤**: ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
- **é•¿åº¦é™åˆ¶**: ä¸¥æ ¼é™åˆ¶å„å­—æ®µé•¿åº¦
- **æ ¼å¼éªŒè¯**: é‚®ç®±ã€ç”µè¯å·ç æ ¼å¼éªŒè¯

### 8.3 é¢‘ç‡é™åˆ¶
```javascript
// é˜²æ­¢åƒåœ¾é‚®ä»¶çš„é¢‘ç‡é™åˆ¶
const rateLimit = require('express-rate-limit');

const contactRateLimit = rateLimit({
  windowMs: 15 * 60 * 1000, // 15åˆ†é’Ÿ
  max: 3, // æœ€å¤š3æ¬¡æäº¤
  message: {
    success: false,
    message: 'Too many contact submissions, please try again later.',
    error: { code: 'RATE_LIMIT_EXCEEDED' }
  }
});
```

### 8.4 æ•°æ®ä¿æŠ¤
- **IPåœ°å€è®°å½•**: è®°å½•æäº¤è€…IPç”¨äºå®‰å…¨å®¡è®¡
- **æ•æ„Ÿä¿¡æ¯å¤„ç†**: é‚®ç®±å’Œç”µè¯å·ç åŠ å¯†å­˜å‚¨ï¼ˆå¯é€‰ï¼‰
- **æ•°æ®ä¿ç•™ç­–ç•¥**: å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®

## 9. å®æ–½è®¡åˆ’

### 9.1 å¼€å‘é˜¶æ®µ

#### é˜¶æ®µ1: æ•°æ®åº“è®¾è®¡ (2å¤©)
- [ ] æ‰©å±• users è¡¨ï¼Œå¢åŠ  role å­—æ®µ
- [ ] åˆ›å»º business_groups è¡¨
- [ ] åˆ›å»º user_business_groups å…³è”è¡¨
- [ ] åˆ›å»º contact_messages è¡¨
- [ ] æ·»åŠ ç›¸å…³ç´¢å¼•å’Œå¤–é”®çº¦æŸ
- [ ] åˆ›å»ºé»˜è®¤ä¸šåŠ¡ç»„æ•°æ®
- [ ] æµ‹è¯•æ•°æ®åº“ç»“æ„

#### é˜¶æ®µ2: åç«¯APIå¼€å‘ (3å¤©)
- [ ] åˆ›å»º contactController.js
- [ ] åˆ›å»º businessGroupController.js
- [ ] åˆ›å»º userManagementController.js
- [ ] åˆ›å»ºç›¸åº”çš„è·¯ç”±æ–‡ä»¶
- [ ] å®ç°ä¸šåŠ¡ç»„ç®¡ç†æ¥å£
- [ ] å®ç°ç”¨æˆ·è§’è‰²ç®¡ç†æ¥å£
- [ ] å®ç°è”ç³»æ¶ˆæ¯æ¥å£ï¼ˆæ”¯æŒä¸šåŠ¡ç»„è·¯ç”±ï¼‰
- [ ] æ·»åŠ æƒé™éªŒè¯ä¸­é—´ä»¶
- [ ] æ·»åŠ è¾“å…¥éªŒè¯å’Œé”™è¯¯å¤„ç†

#### é˜¶æ®µ3: é‚®ä»¶è·¯ç”±æœåŠ¡å¼€å‘ (2å¤©)
- [ ] åˆ›å»ºé‚®ä»¶æ¨¡æ¿
- [ ] å®ç°é‚®ä»¶è·¯ç”±æœåŠ¡
- [ ] å®ç°ç”¨æˆ·æ³¨å†Œæ—¶è‡ªåŠ¨åˆ†é…ä¸šåŠ¡ç»„
- [ ] å®ç°è”ç³»æ¶ˆæ¯çš„ä¸šåŠ¡ç»„é‚®ä»¶é€šçŸ¥
- [ ] é…ç½®é‚®ä»¶é€šçŸ¥
- [ ] æµ‹è¯•é‚®ä»¶åŠŸèƒ½

#### é˜¶æ®µ4: å‰ç«¯ç®¡ç†ç•Œé¢å¼€å‘ (3å¤©)
- [ ] åˆ›å»ºä¸šåŠ¡ç»„ç®¡ç†ç»„ä»¶
- [ ] åˆ›å»ºä¸šåŠ¡äººå‘˜ç®¡ç†ç»„ä»¶
- [ ] åˆ›å»ºè”ç³»æ¶ˆæ¯ç®¡ç†ç»„ä»¶ï¼ˆæ”¯æŒè§’è‰²æƒé™ï¼‰
- [ ] ä¿®æ”¹ Contact.vue ç»„ä»¶
- [ ] é›†æˆçœŸå®APIè°ƒç”¨
- [ ] å®ç°æƒé™æ§åˆ¶
- [ ] ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ
- [ ] æ·»åŠ å›½é™…åŒ–æ”¯æŒ

#### é˜¶æ®µ5: æƒé™å’Œå®‰å…¨ (1å¤©)
- [ ] å®ç°è§’è‰²æƒé™éªŒè¯
- [ ] æ·»åŠ ä¸šåŠ¡äººå‘˜æƒé™é™åˆ¶
- [ ] æµ‹è¯•æƒé™æ§åˆ¶
- [ ] å®‰å…¨æµ‹è¯•

#### é˜¶æ®µ6: æµ‹è¯•å’Œä¼˜åŒ– (2å¤©)
- [ ] åŠŸèƒ½æµ‹è¯•
- [ ] æƒé™æµ‹è¯•
- [ ] é‚®ä»¶è·¯ç”±æµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•
- [ ] ç”¨æˆ·ä½“éªŒæµ‹è¯•
- [ ] é›†æˆæµ‹è¯•

### 9.2 éƒ¨ç½²è®¡åˆ’

#### 9.2.1 ç¯å¢ƒé…ç½®
```bash
# ç¯å¢ƒå˜é‡é…ç½®
CONTACT_AUTO_REPLY_ENABLED=true
CONTACT_RATE_LIMIT_ENABLED=true
DEFAULT_BUSINESS_GROUP_NAME=é»˜è®¤ä¸šåŠ¡ç»„
DEFAULT_BUSINESS_GROUP_EMAIL=default@company.com
AUTO_ASSIGN_NEW_USERS=true
```

#### 9.2.2 æ•°æ®åº“è¿ç§»
```bash
# æ‰§è¡Œæ•°æ®åº“è¿ç§»
mysql -u username -p database_name < db/patch/users_role_extension.sql
mysql -u username -p database_name < db/patch/business_groups_table.sql
mysql -u username -p database_name < db/patch/user_business_groups_table.sql
mysql -u username -p database_name < db/patch/contact_messages_table.sql
mysql -u username -p database_name < db/patch/contact_translations.sql
mysql -u username -p database_name < db/patch/default_business_group_data.sql
```

#### 9.2.3 éƒ¨ç½²æ­¥éª¤

**æµ‹è¯•ç¯å¢ƒéƒ¨ç½²**
- æ•°æ®åº“ç»“æ„æ›´æ–°
- åç«¯æœåŠ¡éƒ¨ç½²
- å‰ç«¯èµ„æºæ›´æ–°
- é‚®ä»¶æœåŠ¡é…ç½®
- åŠŸèƒ½éªŒè¯æµ‹è¯•

**ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²**
- æ•°æ®åº“å¤‡ä»½
- æ»šåŠ¨æ›´æ–°éƒ¨ç½²
- ç›‘æ§ç³»ç»Ÿæ£€æŸ¥
- æ€§èƒ½æŒ‡æ ‡éªŒè¯
- å›æ»šæ–¹æ¡ˆå‡†å¤‡

## 10. ç›‘æ§å’Œç»´æŠ¤

### 10.1 æ—¥å¿—è®°å½•
- è®°å½•æ‰€æœ‰è”ç³»æ¶ˆæ¯æäº¤
- è®°å½•é‚®ä»¶å‘é€çŠ¶æ€
- è®°å½•APIè°ƒç”¨å’Œé”™è¯¯

### 10.2 æ€§èƒ½ç›‘æ§
- ç›‘æ§APIå“åº”æ—¶é—´
- ç›‘æ§æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½
- ç›‘æ§é‚®ä»¶å‘é€æˆåŠŸç‡

### 10.3 æ•°æ®åˆ†æ
- ç»Ÿè®¡è”ç³»æ¶ˆæ¯æ•°é‡è¶‹åŠ¿
- åˆ†æå¸¸è§é—®é¢˜ç±»å‹
- ç›‘æ§å›å¤æ—¶æ•ˆ

## 11. é£é™©è¯„ä¼°

### 11.1 æŠ€æœ¯é£é™©
- **é‚®ä»¶æœåŠ¡æ•…éšœ**: é…ç½®å¤‡ç”¨é‚®ä»¶æœåŠ¡
- **æ•°æ®åº“æ€§èƒ½**: ä¼˜åŒ–æŸ¥è¯¢å’Œç´¢å¼•
- **APIé™æµ**: åˆç†è®¾ç½®é¢‘ç‡é™åˆ¶

### 11.2 ä¸šåŠ¡é£é™©
- **åƒåœ¾é‚®ä»¶**: å®æ–½éªŒè¯ç å’Œé¢‘ç‡é™åˆ¶
- **æ•°æ®æ³„éœ²**: åŠ å¼ºæ•°æ®åŠ å¯†å’Œè®¿é—®æ§åˆ¶
- **æœåŠ¡ä¸­æ–­**: å»ºç«‹ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶

## 12. æ€»ç»“

æœ¬æŠ€æœ¯æ–‡æ¡£è¯¦ç»†è§„åˆ’äº† Contact Us åŠŸèƒ½çš„é‡æ„æ–¹æ¡ˆï¼Œæ¶µç›–äº†ä»æ•°æ®åº“è®¾è®¡åˆ°å‰ç«¯å®ç°çš„å®Œæ•´æŠ€æœ¯æ ˆã€‚é‡æ„åçš„ç³»ç»Ÿå°†å…·å¤‡ï¼š

- **å®Œæ•´çš„ä¸šåŠ¡æµç¨‹**: ä»ç”¨æˆ·æäº¤åˆ°ä¸šåŠ¡ç»„é‚®ä»¶è·¯ç”±çš„é—­ç¯
- **æ™ºèƒ½é‚®ä»¶è·¯ç”±**: æ ¹æ®ç”¨æˆ·æ‰€å±ä¸šåŠ¡ç»„è‡ªåŠ¨è·¯ç”±é‚®ä»¶
- **è§’è‰²æƒé™ç®¡ç†**: æ”¯æŒç®¡ç†å‘˜ã€ä¸šåŠ¡äººå‘˜ã€æ™®é€šç”¨æˆ·ä¸‰ç§è§’è‰²
- **ä¸šåŠ¡ç»„ç®¡ç†**: çµæ´»çš„ä¸šåŠ¡ç»„åˆ›å»ºã€åˆ†é…å’Œç®¡ç†
- **è‡ªåŠ¨ç”¨æˆ·åˆ†é…**: æ–°ç”¨æˆ·æ³¨å†Œæ—¶è‡ªåŠ¨åˆ†é…åˆ°é»˜è®¤ä¸šåŠ¡ç»„
- **æƒé™æ§åˆ¶**: ä¸šåŠ¡äººå‘˜åªèƒ½æŸ¥çœ‹åˆ†é…ç»™è‡ªå·±ç»„çš„æ¶ˆæ¯å’Œè®¢å•
- **è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒ**: å“åº”å¼è®¾è®¡å’Œå‹å¥½çš„é”™è¯¯æç¤º
- **å¼ºå¤§çš„ç®¡ç†åŠŸèƒ½**: åå°æ¶ˆæ¯ç®¡ç†ã€ä¸šåŠ¡ç»„ç®¡ç†å’Œç”¨æˆ·ç®¡ç†
- **å®‰å…¨å¯é **: è¾“å…¥éªŒè¯ã€é¢‘ç‡é™åˆ¶å’Œæ•°æ®ä¿æŠ¤
- **å›½é™…åŒ–æ”¯æŒ**: å¤šè¯­è¨€ç•Œé¢å’Œæ¶ˆæ¯
- **å¯æ‰©å±•æ€§**: æ¨¡å—åŒ–è®¾è®¡ä¾¿äºåç»­åŠŸèƒ½æ‰©å±•

é€šè¿‡éµå¾ªé¡¹ç›®ç°æœ‰çš„æŠ€æœ¯è§„èŒƒå’Œæœ€ä½³å®è·µï¼Œç¡®ä¿é‡æ„åçš„åŠŸèƒ½èƒ½å¤Ÿæ— ç¼é›†æˆåˆ°ç°æœ‰ç³»ç»Ÿä¸­ï¼Œä¸ºç”¨æˆ·æä¾›ä¼˜è´¨çš„è”ç³»ä½“éªŒï¼ŒåŒæ—¶ä¸ºä¼ä¸šæä¾›é«˜æ•ˆçš„å®¢æˆ·æœåŠ¡ç®¡ç†ä½“ç³»ã€‚